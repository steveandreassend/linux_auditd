## LOLBins Used for Exfiltration
##   Ref: https://attack.mitre.org/tactics/TA0010/

## T1567 - Exfiltration over Web Service
##   Ref: https://attack.mitre.org/techniques/T1567/

## T1567 - Exfiltration to Code Repository
##   Ref: https://attack.mitre.org/techniques/T1567/001/

#############################################
## T1567 - Exfiltration Over Web Services
##   Ref: https://attack.mitre.org/techniques/T1567/

## Adversaries may use an existing, legitimate external Web service to exfiltrate data rather than their primary
## command and control channel.

## Monitor execution of cloud storage file transfer utilities
-a always,exit -F arch=b64 -S execve -F comm=aws -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Cloud_Storage
-a always,exit -F arch=b64 -S execve -F comm=gsutil -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Cloud_Storage
-a always,exit -F arch=b64 -S execve -F comm=azcopy -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Cloud_Storage
-a always,exit -F arch=b64 -S execve -F comm=rclone -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Cloud_Storage

## Monitor execution of web-based exfiltration tools (Wget, Curl, SCP, Rsync, FTP)
-a always,exit -F arch=b64 -S execve -F comm=wget -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=curl -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=scp -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=sftp -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=rsync -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=ftp -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=rclone -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols
-a always,exit -F arch=b64 -S execve -F comm=lftp -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Web_Protocols

## Monitor execution of social media clients and command-line tools for potential data exfiltration
-a always,exit -F arch=b64 -S execve -F comm=twurl -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Social_Media
-a always,exit -F arch=b64 -S execve -F comm=instaloader -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Social_Media
-a always,exit -F arch=b64 -S execve -F comm=tiktok-scraper -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Social_Media

## Monitor changes to web upload directories (indicating potential exfiltration attempts)
-w /var/www/html/uploads/ -p wa -k T1567_Exfiltration_Web_Protocols
-w /usr/share/nginx/html/uploads/ -p wa -k T1567_Exfiltration_Web_Protocols

## Monitor execution of scripting languages commonly used for exfiltration
##-a always,exit -F arch=b64 -S execve -F comm=python3 -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Scripting
##-a always,exit -F arch=b64 -S execve -F comm=perl -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Scripting
##-a always,exit -F arch=b64 -S execve -F comm=bash -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Scripting
## Covered by OS Credential Dumping

##  Monitor Use of Email Clients for Data Exfiltration
-a always,exit -F arch=b64 -S execve -F comm=sendmail -F auid>=1000 -F auid!=4294967295 -k T1567_Email_Exfiltration
-a always,exit -F arch=b64 -S execve -F comm=mail -F auid>=1000 -F auid!=4294967295 -k T1567_Email_Exfiltration
-a always,exit -F arch=b64 -S execve -F comm=mutt -F auid>=1000 -F auid!=4294967295 -k T1567_Email_Exfiltration
-a always,exit -F arch=b64 -S execve -F comm=alpine -F auid>=1000 -F auid!=4294967295 -k T1567_Email_Exfiltration
-a always,exit -F arch=b64 -S execve -F comm=thunderbird -F auid>=1000 -F auid!=4294967295 -k T1567_Email_Exfiltration


#############################################
## T1567 - Exfiltration to Code Repository
##   Ref: https://attack.mitre.org/techniques/T1567/001/

## Monitor execution of Git and code repository tools
-a always,exit -F arch=b64 -S execve -F comm=git -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Code_Repositories
-a always,exit -F arch=b64 -S execve -F comm=gh -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Code_Repositories
-a always,exit -F arch=b64 -S execve -F comm=git-lfs -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Code_Repositories
-a always,exit -F arch=b64 -S execve -F comm=bzr -F auid>=1000 -F auid!=4294967295 -k T1567_Exfiltration_Code_Repositories
